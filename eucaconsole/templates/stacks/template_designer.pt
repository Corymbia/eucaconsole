<metal:block use-macro="main_template" i18n:domain="eucaconsole">

<head metal:fill-slot="head_css">
    <link rel="stylesheet" type="text/css" href="${request.static_path('eucaconsole:static/css/pages/template_designer.css')}" />
</head>

<div metal:fill-slot="main_content">
    <div class="row" id="contentwrap" ng-app="TemplateDesigner" ng-controller="TemplateDesignerCtrl as designCtrl" ng-init="designCtrl.initController('${json_opts}', 'blah')"> 
        <metal:breadcrumbs metal:use-macro="layout.global_macros['breadcrumbs']">
            <metal:crumbs metal:fill-slot="crumbs">
                <li><a href="${request.route_path('stacks')}" i18n:translate="">Stacks</a></li>
                <li class="current"><a href="#" i18n:translate="">Template Designer</a></li>
            </metal:crumbs>
        </metal:breadcrumbs>
        <!-- Notifications -->
        <metal:block metal:use-macro="layout.global_macros['notifications']" />
        <h3 id="pagetitle">
            <strong i18n:translate="">Tempate Designer:</strong>
        </h3>
        <div class="large-2 columns">
            <div ng-repeat="(name, svc) in designCtrl.resources">
                <h6>{{ name }}</h6>
                <div ng-repeat="res in svc">
                    <div class="draggable" ng-drag="true" ng-drag-data="res" data-allow-transform="true" draggable="false">{{ res.name }}</div>
                </div>
            </div>
            <hr/>
            <a data-reveal-id="add-parameter-modal">Add Parameter</a>
            <hr/>
            <a ng-click="designCtrl.undoLast()" ng-disabled="designCtrl.canUndo()">Undo</a>
        </div>
        <div class="large-10 columns">
            <div id="graph-area" ng-drop="true" ng-drop-success="designCtrl.dropComplete($data, $event)">
                <svg/>
            </div>
            <div id="template-text-area">
                <textarea id="template-editor">
                    {{ designCtrl.templateText }}
                </textarea>
            </div>
        </div>
        <ul id="designer-action-menu" class="f-dropdown" data-dropdown-content="">
            <li><a i18n:translate="" ng-click="designCtrl.showPropertiesEditor()">Properties</a></li>
            <li><a i18n:translate="">Copy</a></li>
        </ul>
        <div id="property-editor-modal" class="reveal-modal medium" data-reveal="">
            <h3 i18n:translate="">Resource properties</h3>
            <p>
                Set properties for this resource. Some properties will form links to other resources.
            </p>
            <div class="section">
                <div class="row" ng-repeat="property in designCtrl.selectedNode.properties">
                    <div class="columns small-3">
                        <label class="right">{{ property.label }}
                            <span ng-if="property.required" class="req">*</span>
                        </label>
                    </div>
                    <div class="columns small-9">
                        <input ng-attr-id="res-prop-{{property.name}}" ng-if="property.datatype == 'string'" width="90%" type="text"/ value="{{property.value}}">
                        <input ng-attr-id="res-prop-{{property.name}}" ng-if="property.datatype == 'int'" width="10" type="integer"/ value="{{property.value}}">
                        <select ng-attr-id="res-prop-{{property.name}}" ng-if="property.datatype == 'link'">
                            <option>what</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="dialog-submit-button">
                <button type="submit" id="save_properties_button" class="button expand"
                    ng-click="designCtrl.saveProperties()" i18n:translate="">Save Properties</button>
            </div>
            <a href="#" id="attach_volume_close_link" class="close-reveal-modal">&#215;</a>
        </div>
        <div id="add-parameter-modal" class="reveal-modal small" data-reveal="">
            <h3 i18n:translate="">Add parameter</h3>
            <div class="section">
                <div class="row">
                    <div class="columns small-4">
                        <label class="right" i18n:translate="">Name</label>
                    </div>
                    <div class="columns small-8">
                        <input width="100%" type="text" ng-model="designCtrl.newParam.name" id="param-name"/>
                    </div>
                </div>
                <div class="row">
                    <div class="columns small-4">
                        <label class="right" i18n:translate="">Description</label>
                    </div>
                    <div class="columns small-8">
                        <input width="100%" type="text" ng-model="designCtrl.newParam.description" id="param-description"/>
                    </div>
                </div>
                <div class="row">
                    <div class="columns small-4">
                        <label class="right" i18n:translate="">Type</label>
                    </div>
                    <div class="columns small-8">
                        <select width="100%" type="text" ng-model="designCtrl.newParam.datatype" id="param-type">
                            <option>String</option>
                            <option>Number</option>
                            <option>AWS::EC2:AvailabilityZone</option>
                            <option>AWS::EC2:Image::Id</option>
                            <option>AWS::EC2:Instance::Id</option>
                            <option>AWS::EC2:KeyPair::KeyName</option>
                            <option>AWS::EC2:SecurityGroup::GroupName</option>
                            <option>AWS::EC2:SecurityGroup::Id</option>
                            <option>AWS::EC2:Subnet::Id</option>
                            <option>AWS::EC2:Volume::Id</option>
                            <option>AWS::EC2:VPC::Id</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="columns small-4">
                        <label class="right" i18n:translate="">Default</label>
                    </div>
                    <div class="columns small-8">
                        <input width="100%" type="text" ng-model="designCtrl.newParam.default" id="param-default"/>
                    </div>
                </div>
            </div>
            <div class="dialog-submit-button">
                <button type="submit" ng-click="designCtrl.addParameter()" id="add_parameter_button" class="button expand" i18n:translate="">Add Parameter</button>
            </div>
            <a href="#" id="attach_volume_close_link" class="close-reveal-modal">&#215;</a>
        </div>
    </div>
</div>

<div metal:fill-slot="tail_js">
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/d3/d3.min.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/webcola/cola.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/angular/ngDraggable.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/pages/template_designer.js')}"></script>
</div>

</metal:block>


