<metal:block use-macro="main_template" i18n:domain="eucaconsole" xmlns="http://www.w3.org/1999/html">

<head metal:fill-slot="head_css">
    <link rel="stylesheet" type="text/css" href="${request.static_path('eucaconsole:static/css/pages/instance.css')}" />
    <link rel="stylesheet" type="text/css" href="${request.static_path('eucaconsole:static/js/thirdparty/nvd3/nv.d3.min.css')}" />
</head>

<div metal:fill-slot="main_content">
    <div class="row" id="contentwrap" ng-app="InstanceMonitoring" ng-controller="InstanceMonitoringCtrl as monitoringCtrl"
         ng-init="monitoringCtrl.initController('${controller_options_json}')">
        <metal:breadcrumbs metal:use-macro="layout.global_macros['breadcrumbs']">
            <metal:crumbs metal:fill-slot="crumbs">
                <li><a href="${request.route_path('instances')}" i18n:translate="">Instances</a></li>
                <li class="current"><a href="#">${instance_name}</a></li>
            </metal:crumbs>
        </metal:breadcrumbs>
        <!--! Notifications -->
        <metal:block metal:use-macro="layout.global_macros['notifications']" />
        <h3 id="pagetitle">
            <strong i18n:translate="">Details for instance:</strong>
            <em>${instance_name}</em>
        </h3>
        <div class="large-12 columns">
            <dl class="tabs" id="instance-subnav">
                <dd><a href="${request.route_path('instance_view', id=instance.id)}" i18n:translate="">General</a></dd>
                <dd><a href="${request.route_path('instance_volumes', id=instance.id)}" i18n:translate="">Volumes</a></dd>
                <dd class="active"><a i18n:translate="">Monitoring</a></dd>
            </dl>
            <div class="panel no-title cloudwatch-charts">
                <div class="toprow">
                    <div class="blurb">
                        <div class="timespan-wrapper" tal:condition="monitoring_enabled">
                            <label class="left" i18n:translate="">Show data for</label>
                            <select name="monitoring_duration" ng-model="monitoringCtrl.monitoringDuration"
                                    ng-options="opt.label as opt.val for opt in monitoringCtrl.monitoringDurationChoices">
                            </select>
                        </div>
                    </div>
                    <div class="actions">
                        <span id="enable-monitoring-icon" class="vdots dropdown"
                              data-dropdown="enable-monitoring-dropdown"><i class="fa fa-ellipsis-v"></i></span>
                        <ul id="enable-monitoring-dropdown" class="f-dropdown" data-dropdown-content="">
                            <li>
                                <a href="" ng-click="monitoringCtrl.submitMonitoringForm()">
                                    <span i18n:translate="">Turn monitoring</span>
                                    <span i18n:translate="" tal:condition="monitoring_enabled">off</span>
                                    <span i18n:translate="" tal:condition="not monitoring_enabled">on</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div tal:condition="not monitoring_enabled">
                    <p i18n:translate="">Monitoring is currently turned off for this instance.</p>
                    <p i18n:translate="">Turn on monitoring to view metric data.</p>
                </div>
                <ul class="small-block-grid-1 medium-block-grid-2 large-block-grid-3" tal:condition="monitoring_enabled">
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">CPU utilization</h6>
                        <svg cloudwatch-chart="" id="cwchart-cpu" class="cwchart" ids="${instance.id}" idtype="InstanceId"
                             metric="CPUUtilization" duration="3600" unit="Percent" statistic="Average"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Disk read bytes</h6>
                        <svg cloudwatch-chart="" id="cwchart-disk-read-bytes" class="cwchart" ids="${instance.id}" idtype="InstanceId"
                             metric="DiskReadBytes" duration="3600" unit="Bytes"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Disk read operations</h6>
                        <svg cloudwatch-chart="" id="cwchart-disk-read-ops" class="cwchart" ids="${instance.id}" idtype="InstanceId"
                             metric="DiskReadOps" duration="3600" unit="Count"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Disk write bytes</h6>
                        <svg cloudwatch-chart="" id="cwchart-disk-write-bytes" class="cwchart" ids="${instance.id}" idtype="InstanceId"
                             metric="DiskWriteBytes" duration="3600" unit="Bytes"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Disk write operations</h6>
                        <svg cloudwatch-chart="" id="cwchart-disk-write-ops" class="cwchart" ids="${instance.id}" idtype="InstanceId"
                             metric="DiskWriteOps" duration="3600" unit="Count"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Network in KB</h6>
                        <svg cloudwatch-chart="" id="cwchart-networkin" class="cwchart" ids="${instance.image_id}"
                             idtype="ImageId" metric="NetworkIn" duration="3600" unit="Bytes"></svg>
                    </li>
                    <li class="chart-wrapper">
                        <h6 i18n:translate="">Network out KB</h6>
                        <svg cloudwatch-chart="" id="cwchart-networkout" class="cwchart" ids="${instance.image_id}"
                             idtype="ImageId" metric="NetworkOut" duration="3600" unit="Bytes"></svg>
                    </li>
                </ul>
            </div>
        </div>
        <form method="post" id="monitoring-form" action="${request.route_path('instance_monitoring_update', id=instance.id)}">
            ${structure:monitoring_form['csrf_token']}
        </form>
    </div>
</div>

<div metal:fill-slot="tail_js">
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/jquery/chosen.jquery.min.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/d3/d3.min.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/thirdparty/nvd3/nv.d3.min.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/pages/cloudwatch_charts.js')}"></script>
    <script src="${request.static_path('eucaconsole:static/js/pages/instance_monitoring.js')}"></script>
</div>

</metal:block>
