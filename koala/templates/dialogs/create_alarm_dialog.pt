<!--! Create alarm dialog -->
<div id="create-alarm-wrapper" ng-app="CreateAlarm" ng-controller="CreateAlarmCtrl">
    <div id="create-alarm-modal" class="reveal-modal ${modal_size}" data-reveal="">
        <h3 i18n:translate="">Create alarm</h3>
        <p i18n:translate="">&nbsp;</p>
        <form action="${request.route_url('cloudwatch_alarms_create')}" method="post" data-abide="">
            ${structure:alarm_form['csrf_token']}
            ${panel('form_field', field=alarm_form['name'], leftcol_width=3, rightcol_width=9)}
            ${panel('form_field', field=alarm_form['description'], leftcol_width=3, rightcol_width=9)}
            <hr />
            <div class="row controls-wrapper">
                <div class="small-3 columns">
                    <label class="right">Trigger alarm</label>
                </div>
                <div class="small-9 columns">
                    <div class="row">
                        <div class="large-5 columns">
                            <div class="row">
                                <div class="small-5 columns">
                                    <span i18n:translate="" class="inline-label">When the</span>
                                </div>
                                <div class="small-7 columns">
                                    ${structure:alarm_form['statistic']}
                                </div>
                            </div>
                        </div>
                        <div class="large-7 columns"
                             tal:define="metric_attrs {'ng-model': 'metric', 'ng-change': 'updateDimensionChoices()'}">
                            ${structure:alarm_form.metric(**metric_attrs)}
                        </div>
                    </div>
                    <div class="row">
                        <div class="large-6 columns">
                            <div class="row">
                                <div class="small-2 columns">
                                    <span i18n:translate="" class="inline-label">for</span>
                                </div>
                                <div class="small-10 columns">
                                    <select name="dimension" ng-model="dimension">
                                        <option value="" i18n:translate="">select...</option>
                                        <option value="" i18n:translate="" value="availability_zone"
                                                ng-disabled="namespace !== 'AWS/ELB'"
                                                ng-selected="namespace === 'AWS/ELB'">Availability zone</option>
                                        <option value="" i18n:translate="" value="image"
                                                ng-disabled="['AWS/EC2', 'AWS/AutoScaling'].indexOf(namespace) === -1">Image</option>
                                        <option value="" i18n:translate="" value="instance"
                                                ng-disabled="['AWS/EC2', 'AWS/AutoScaling'].indexOf(namespace) === -1">Instance</option>
                                        <option value="" i18n:translate="" value="instance_type"
                                                ng-disabled="['AWS/EC2', 'AWS/AutoScaling'].indexOf(namespace) === -1">Instance type</option>
                                        <option value="" i18n:translate="" value="load_balancer"
                                                ng-disabled="namespace !== 'AWS/ELB'">Load balancer</option>
                                        <option value="" i18n:translate="" value="scaling group"
                                                ng-disabled="namespace !== 'AWS/AutoScaling'"
                                                ng-selected="namespace === 'AWS/AutoScaling'">Scaling group</option>
                                        <option value="" i18n:translate="" value="volume"
                                                ng-disabled="namespace !== 'AWS/EBS'"
                                                ng-selected="metric.indexOf('Volume') === 0">Volume</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="large-6 columns">
                            <!-- Pull in select fields for dimension value choices.
                                 The appropriate field is displayed based on the dimension choice above -->
                            <div tal:omit-tag="" tal:define="avail_zone_attrs {'ng-show': 'dimension == \'availability_zone\''}">
                                ${structure:alarm_form.availability_zone(**avail_zone_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="image_attrs {'ng-show': 'dimension == \'image\''}">
                                ${structure:alarm_form.image_id(**image_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="instance_attrs {'ng-show': 'dimension == \'instance\''}">
                                ${structure:alarm_form.instance_id(**instance_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="instance_type_attrs {'ng-show': 'dimension == \'instance_type\''}">
                                ${structure:alarm_form.instance_type(**instance_type_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="elb_attrs {'ng-show': 'dimension == \'load_balancer\''}">
                                ${structure:alarm_form.load_balancer_name(**elb_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="volume_attrs {'ng-show': 'dimension == \'volume\''}">
                                ${structure:alarm_form.volume_id(**volume_attrs)}
                            </div>
                            <div tal:omit-tag="" tal:define="sgroup_attrs {'ng-show': 'dimension == \'scaling_group\''}">
                                ${structure:alarm_form.scaling_group_name(**sgroup_attrs)}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="small-1 columns">
                            <span i18n:translate="">is</span>
                        </div>
                        <div class="small-2 columns">
                            ${structure:alarm_form['comparison']}
                        </div>
                        <div class="small-4 columns">
                            ${structure:alarm_form['threshold']}
                        </div>
                        <div class="small-5 columns">
                            ${structure:alarm_form['unit']}
                        </div>
                    </div>
                </div>
            </div>
            <hr />
            <div class="row controls-wrapper">
                <div class="small-3 columns">
                    <label class="right" i18n:translate="">Evaluation</label>
                </div>
                <div class="small-9 columns">
                    ${panel('form_field', field=alarm_form['evaluation_periods'])}
                    ${panel('form_field', field=alarm_form['period'])}
                </div>
            </div>
            <hr />
            <div class="row">
                <div class="small-3 columns">&nbsp;</div>
                <div class="small-9 columns">
                    <button type="submit" class="button" i18n:translate="">Add alarm</button>
                </div>
            </div>
        </form>
        <a class="close-reveal-modal">&#215;</a>
        <script src="${request.static_url('koala:static/js/pages/create_alarm.js')}"></script>
    </div>
</div>
